'use client';

import Header from './header';
import React, { useRef, useEffect } from 'react';
import { AnimatePresence, motion, useAnimate, useScroll, useTransform } from 'framer-motion';


export default function Hero() {
	const container = useRef(null);
	const [scope, animate] = useAnimate();
	const { scrollYProgress } = useScroll();
    const [animationFinished, setAnimationStatus] = React.useState<boolean>(false);

	const y = useTransform(scrollYProgress, [0, 1], ['0%', '-100%']);
	const pathsRef = useRef<Array<SVGPathElement | null>>([]);
    
	useEffect(() => {
		pathsRef.current.forEach((path) => {
			if (path)
				animate(
					path,
					{
						pathLength: [0, 1],
					},
					{
						type: 'spring',
						damping: 40,
					}
				)
                .then(() => {
                    animate(path, { fill: 'hsl(var(--foreground))' });
                })
                .then(() => {
                    setTimeout(() => setAnimationStatus(true), 50);
                });
		});
	}, [animate]);

	return (
    <>
        <AnimatePresence>
            {animationFinished &&
                <Header status={animationFinished} />
            }
        </AnimatePresence>

        <section
            ref={container}
            className='relative w-screem h-screen'
        >
            <div className='flex justify-end items-start py-32 md:py-64 w-full h-full container'>
                
                <AnimatePresence mode='wait'>
                    {animationFinished &&
                        <motion.div
                            initial={{
                                opacity: 0,
                                y: -100
                            }}
                            animate={{
                                opacity: 1,
                                y: 0
                            }}
                            transition={{
                                duration: 0.2,
                                type: 'spring',
                                damping: 30
                            }}
                            className='flex flex-col gap-8 w-full md:w-1/2 md:h-1/2'
                        >
                            <p className='flex flex-col w-fit text-foreground text-lg leading-tight'>
                                <span>
                                    I am <strong>misael mart√≠nez</strong>,
                                </span>
                                <span>
                                    a <strong>full stack developer</strong> &
                                </span>
                                <span>
                                    <strong>graphic designer</strong> based
                                </span>
                                <span>on puerto rico.</span>
                            </p>
                            <motion.hr
                                initial={{
                                    opacity: 0,
                                    width: 0
                                }}
                                animate={{
                                    opacity: 1,
                                    width: '100%'
                                }}
                                transition={{
                                    delay: 1,
                                    duration: 1,
                                    type: 'spring',
                                    damping: 40
                                }}
                                className='bg-foreground border-none w-0 h-px'
                            />
                        </motion.div>
                    }
                </AnimatePresence>

            </div>

            <motion.svg
                ref={scope}
                fill='none'
                width='1440'
                height='1072'
                viewBox='0 0 1440 1072'
                className='bottom-0 left-0 absolute w-screen h-auto scale-125'
                style={{ y }}
                xmlns='http://www.w3.org/2000/svg'>
                {[
                    'M234.794 411.163V513.318H173.674C130.117 513.318 96.1613 502.75 71.8068 481.615C47.4524 460.01 35.2751 425.019 35.2751 376.642V220.239H-12.4971V120.198H35.2751V24.3833H155.408V120.198H234.092V220.239H155.408V378.051C155.408 389.793 158.218 398.247 163.839 403.413C169.459 408.58 178.826 411.163 191.94 411.163H234.794Z',

                    'M386.717 185.718C400.768 164.113 418.331 147.204 439.407 134.993C460.483 122.311 483.901 115.971 509.66 115.971V243.488H476.641C446.666 243.488 424.185 250.064 409.198 263.215C394.211 275.896 386.717 298.44 386.717 330.848V513.318H266.584V120.198H386.717V185.718Z',

                    'M592.372 79.3356C571.296 79.3356 553.967 73.2298 540.385 61.0182C527.271 48.3369 520.714 32.8375 520.714 14.5201C520.714 -4.26702 527.271 -19.7664 540.385 -31.978C553.967 -44.6593 571.296 -51 592.372 -51C612.98 -51 629.841 -44.6593 642.955 -31.978C656.537 -19.7664 663.328 -4.26702 663.328 14.5201C663.328 32.8375 656.537 48.3369 642.955 61.0182C629.841 73.2298 612.98 79.3356 592.372 79.3356ZM652.088 120.198V513.318H531.955V120.198H652.088Z',

                    'M-30 869.099C-30 828.707 -22.5063 793.246 -7.51896 762.717C7.93675 732.188 28.7785 708.704 55.0064 692.265C81.2343 675.827 110.506 667.607 142.823 667.607C168.583 667.607 192 673.009 213.076 683.811C234.621 694.614 251.481 709.174 263.659 727.491V545.021H383.792V1066.36H263.659V1010C252.418 1028.79 236.26 1043.82 215.184 1055.09C194.576 1066.36 170.456 1072 142.823 1072C110.506 1072 81.2343 1063.78 55.0064 1047.34C28.7785 1030.43 7.93675 1006.71 -7.51896 976.186C-22.5063 945.187 -30 909.491 -30 869.099ZM263.659 869.804C263.659 839.744 255.228 816.025 238.367 798.647C221.975 781.269 201.836 772.58 177.95 772.58C154.063 772.58 133.69 781.269 116.829 798.647C100.437 815.556 92.2406 839.04 92.2406 869.099C92.2406 899.158 100.437 923.112 116.829 940.96C133.69 958.338 154.063 967.027 177.95 967.027C201.836 967.027 221.975 958.338 238.367 940.96C255.228 923.582 263.659 899.863 263.659 869.804Z',

                    'M411.69 869.099C411.69 828.707 419.184 793.246 434.171 762.717C449.627 732.188 470.468 708.704 496.696 692.265C522.924 675.827 552.196 667.607 584.513 667.607C610.272 667.607 633.69 673.009 654.766 683.811C676.31 694.614 693.171 709.174 705.348 727.491V545.021H825.481V1066.36H705.348V1010C694.108 1028.79 677.95 1043.82 656.874 1055.09C636.266 1066.36 612.146 1072 584.513 1072C552.196 1072 522.924 1063.78 496.696 1047.34C470.468 1030.43 449.627 1006.71 434.171 976.186C419.184 945.187 411.69 909.491 411.69 869.099ZM705.348 869.804C705.348 839.744 696.918 816.025 680.057 798.647C663.665 781.269 643.525 772.58 619.639 772.58C595.753 772.58 575.38 781.269 558.519 798.647C542.127 815.556 533.93 839.04 533.93 869.099C533.93 899.158 542.127 923.112 558.519 940.96C575.38 958.338 595.753 967.027 619.639 967.027C643.525 967.027 663.665 958.338 680.057 940.96C696.918 923.582 705.348 899.863 705.348 869.804Z',

                    'M853.38 869.099C853.38 828.707 860.873 793.246 875.861 762.717C891.316 732.188 912.158 708.704 938.386 692.265C964.614 675.827 993.886 667.607 1026.2 667.607C1051.96 667.607 1075.38 673.009 1096.46 683.811C1118 694.614 1134.86 709.174 1147.04 727.491V545.021H1267.17V1066.36H1147.04V1010C1135.8 1028.79 1119.64 1043.82 1098.56 1055.09C1077.96 1066.36 1053.84 1072 1026.2 1072C993.886 1072 964.614 1063.78 938.386 1047.34C912.158 1030.43 891.316 1006.71 875.861 976.186C860.873 945.187 853.38 909.491 853.38 869.099ZM1147.04 869.804C1147.04 839.744 1138.61 816.025 1121.75 798.647C1105.35 781.269 1085.22 772.58 1061.33 772.58C1037.44 772.58 1017.07 781.269 1000.21 798.647C983.816 815.556 975.62 839.04 975.62 869.099C975.62 899.158 983.816 923.112 1000.21 940.96C1017.07 958.338 1037.44 967.027 1061.33 967.027C1085.22 967.027 1105.35 958.338 1121.75 940.96C1138.61 923.582 1147.04 899.863 1147.04 869.804Z',

                    'M1448.22 673.243V1066.36H1328.09V673.243H1448.22ZM1470 575.316L1300.69 646.472V563.339L1470 481.615V575.316Z',
                ].map((d, i) => (
                    <motion.path
                        key={i}
                        d={d}
                        strokeWidth="1"
                        fill='transparent'
                        stroke="hsl(var(--foreground))"
                        className='transition-[fill] duration-500'
                        ref={(el) => (pathsRef.current[i] = el)}
                    />
                ))}
            </motion.svg>
        </section>
    </>
	);
}
